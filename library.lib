PUSH BP
MOV BP, SP
MOV R0, BP
MOV R1, -6
ADD R0, R1
MOV R0, [R0]
MOV R1, "Heapset"
EQ R1, R0
JZ R1, 70
MOV R2, 0
MOV R3, 128
MOV R4, 1023
MOV R1, R2
LT R1, R3
JZ R1, 62
INR R4
MOV R5, R4
ADD R5, 8
MOV [R4], R5
MOV R6, 1
MOV R7, 8
MOV R1, R6
LT R1, R7
JZ R1, 58
INR R4
MOV R8, -1
MOV [R4], R8
INR R6
JMP 42
ADD R2, 1
JMP 24
MOV R2, 2040
MOV R3, -1
MOV [R2], R3
JMP 276
MOV R1, "Alloc"
EQ R1, R0
JZ R1, 100
MOV R2, 1024
MOV R3, -1
MOV R1, [R2]
NE R1, R3
JZ R1, 92
MOV R3, [R2]
MOV R4, [R3]
MOV [R2], R4
MOV R5, BP
ADD R5, -2
MOV [R5], R3
JMP 276
MOV R1, "Free"
EQ R1, R0
JZ R1, 154
MOV R2, BP
ADD R2, -5
MOV R2, [R2]
MOV R3, 1
MOV R4, R2
ADD R4, 1
MOV R6, 8
MOV R1, R3
LT R1, R6
JZ R1, 136
MOV R7, -1
MOV [R4], R7
INR R4
INR R3
JMP 120
MOV R5, 1024
MOV R6, [R5]
MOV [R2], R6
MOV [R5], R2
MOV R2, BP
ADD R2, -2
MOV R3, 1
MOV [R2], R3
JMP 276
MOV R1, "Write"
EQ R1, R0
JZ R1, 200
MOV R2, BP
ADD R2, -4
MOV R2, [R2]
MOV R3, 5
PUSH R3
MOV R3, -2
PUSH R3
PUSH R2
PUSH R3
PUSH R3
INT 7
POP R4
POP R3
POP R3
POP R3
POP R3
MOV R2, BP
ADD R2, -2
MOV [R2], R4
JMP 276
MOV R1, "Read"
EQ R1, R0
JZ R1, 246
MOV R2, BP
ADD R2, -4
MOV R2, [R2]
MOV R3, 7
PUSH R3
MOV R3, -1
PUSH R3
PUSH R2
PUSH R3
PUSH R3
INT 6
POP R4
POP R3
POP R3
POP R3
POP R3
MOV R2, BP
ADD R2, -2
MOV [R2], R4
JMP 276
MOV R1, "Exit"
EQ R1, R0
JZ R1, 276
MOV R2, 10
PUSH R2
PUSH R2
PUSH R2
PUSH R2
PUSH R2
INT 10
POP R2
POP R2
POP R2
POP R2
POP R2
POP BP
RET
